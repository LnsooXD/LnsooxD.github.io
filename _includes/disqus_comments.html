{% if page.comments != false and jekyll.environment == "production" %}
<div id="disqus_thread"></div>
<script>
  (function() {
    var disqus_thread_el = document.getElementById("disqus_thread");
    var disqus_script_state_el = document.createElement("p");
    disqus_script_state_el.style.color = "gray";
    disqus_script_state_el.innerHTML = "正在加载评论...";
    disqus_thread_el.appendChild(disqus_script_state_el);

    var disqus_load_result = false;
    var disqus_load_action_done = false;

    var check_disqus_load_result = function() {
      if (disqus_load_action_done) {
        return;
      }

      disqus_load_action_done = true;

      if (disqus_load_result) {
        disqus_script_state_el.remove();
      } else {
        disqus_script_state_el.innerHTML = "评论加载失败, 请检查网络";
      }
    };

    window.disqus_config = function() {
      this.page.url = "{{ page.url | absolute_url }}";
      this.page.identifier = "{{ page.url | absolute_url }}";
    };
    var disqus_script = document.createElement("script");
    // disqus_script.src = "//{{ site.disqus.shortname }}.disqus.com/embed.js";
    disqus_script.src = "/disqus/embed.js";
    disqus_script.async = true;
    disqus_script.onload = function() {
      disqus_load_result = true;
      check_disqus_load_result();
    };

    disqus_script.onerror = check_disqus_load_result;
    disqus_script.setAttribute("data-timestamp", +new Date());
    (document.head || document.body).appendChild(disqus_script);
    setTimeout(check_disqus_load_result, 3000);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="//disqus.com/?ref_noscript" rel="nofollow"
    >comments powered by Disqus.</a
  ></noscript
>
{% endif %}
